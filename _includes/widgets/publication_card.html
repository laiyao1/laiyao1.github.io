{% assign publications = include.publications %}
<div class="my-3 p-0 bg-white shadow-sm rounded-sm">
    <h6 class="border-bottom border-gray p-3 mb-0">
        {% if include.title %}{{ include.title }}{% else %}<i class="fas fa-star"></i> Selected Recent Publications{% endif %} 
        <a href="{{ 'publications' | relative_url }}">(view all <i class="fas fa-angle-double-right"></i>)</a>
    </h6>
    {% for item in publications limit:include.limit %}
        {% include widgets/publication_item.html item=item %}    
    {% endfor %}
    <h6 class="d-block p-3 mt-0 text-right">
        <a href="{{ 'publications' | relative_url }}">All publications <i class="fas fa-angle-double-right"></i></a>
    </h6>
</div>

<!-- Citation功能的CSS -->
<style>
.badge {
    display: inline-block;
    padding: 0.25em 0.4em;
    font-size: 0.75rem;  /* 改为固定大小 */
    font-weight: 700;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 0.25rem;
}

.badge-publication {
    font-size: 0.75rem;  /* 固定大小 */
    border-radius: 10rem;
    margin-left: 0.25rem;
    margin-right: 0.25rem;
}


.badge-pill {
    padding-right: 0.6em;
    padding-left: 0.6em;
    border-radius: 10rem;
}


/* Badge颜色样式 */
.badge-success {
    color: #fff;
    background-color: #28a745;
}

.badge-warning {
    color: #212529;
    background-color: #ffc107;
}

.badge-info {
    color: #fff;
    background-color: #17a2b8;
}

.badge-danger {
    color: #fff;
    background-color: #dc3545;
}

.badge-secondary {
    color: #fff;
    background-color: #6c757d;
}

.badge-primary {
    color: #fff;
    background-color: #007bff;
}

/* Citation badge 样式 */
.citation-badge {
    display: inline-block;
    margin-left: 0.25rem;
}

.citation-badge a {
    text-decoration: none;
    transition: opacity 0.3s ease;
}

.citation-badge a:hover {
    opacity: 0.85;
}
</style>

<!-- Citation功能的JS - 静态版本 -->
{% assign publications = include.publications %}
<div class="my-3 p-0 bg-white shadow-sm rounded-sm">
    <h6 class="border-bottom border-gray p-3 mb-0">
        {% if include.title %}{{ include.title }}{% else %}<i class="fas fa-star"></i> Selected Recent Publications{% endif %} 
        <a href="{{ 'publications' | relative_url }}">(view all <i class="fas fa-angle-double-right"></i>)</a>
    </h6>
    {% for item in publications limit:include.limit %}
        {% include widgets/publication_item.html item=item %}    
    {% endfor %}
    <h6 class="d-block p-3 mt-0 text-right">
        <a href="{{ 'publications' | relative_url }}">All publications <i class="fas fa-angle-double-right"></i></a>
    </h6>
</div>

<script>
(function() {
    async function loadCitations() {
        try {
            const response = await fetch('{{ "/assets/data/publications.json" | relative_url }}');
            if (!response.ok) return;
            const data = await response.json();
            
            document.querySelectorAll('[data-paper-id]').forEach(el => {
                const id = el.getAttribute('data-paper-id');
                const badge = el.querySelector('.citation-badge');
                if (!badge) return;
                
                const paper = data.papers.find(p => p.id === id);
                if (!paper || paper.citations == null) {
                    badge.style.display = 'none';
                    return;
                }
                
                const s2Id = paper.semantic_scholar?.paper_id;
                const count = paper.citations;
                const label = count === 1 ? 'citation' : 'citations';
                
                if (s2Id) {
                    badge.innerHTML = `<a href="https://www.semanticscholar.org/paper/${s2Id}" target="_blank" class="badge badge-pill badge-info" style="color:#fff;text-decoration:none;font-size:0.75rem;"><i class="fas fa-quote-right"></i> ${count} ${label}</a>`;
                } else {
                    badge.innerHTML = `<span class="badge badge-pill badge-info" style="font-size:0.75rem;"><i class="fas fa-quote-right"></i> ${count} ${label}</span>`;
                }
            });
        } catch (e) {
            console.error('Citation load error:', e);
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadCitations);
    } else {
        loadCitations();
    }
})();
</script>